<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Koderen</title>
<link rel="icon" href="data:image/png;base64,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">

<style>
:root {
--bg-color: #0d1117;
--text-color: #c9d1d9;
--accent-color: #58a6ff;
--border-color: #30363d;
--caret-color: #58a6ff;
--selection-bg: rgba(88, 166, 255, 0.3);
--font-mono: 'Menlo', 'Monaco', 'Courier New', monospace;
--font-size: 15px;
}
html,
body {
margin: 0;
padding: 0;
width: 100%;
height: 100%;
background-color: var(--bg-color);
color: var(--text-color);
font-family: var(--font-mono);
overflow: hidden;
}
.editor-container {
display: flex;
height: 100vh;
width: 100vw;
}
#line-numbers {
width: 50px;
padding: 15px 5px 15px 15px;
box-sizing: border-box;
text-align: right;
color: var(--border-color);
user-select: none;
overflow: hidden;
font-size: var(--font-size);
line-height: 1.5;
background-color: var(--bg-color);
white-space: pre;
}
textarea#editor {
flex-grow: 1;
height: 100%;
box-sizing: border-box;
border: none;
outline: none;
resize: none;
white-space: pre;
overflow-wrap: normal;
overflow: auto;
background-color: transparent;
color: var(--text-color);
font-family: var(--font-mono);
font-size: var(--font-size);
padding: 15px;
caret-color: var(--caret-color);
line-height: 1.5;
}
textarea::selection {
background-color: var(--selection-bg);
}
.modal {
display: none;
position: fixed;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
width: 450px;
background-color: var(--bg-color);
border: 1px solid var(--border-color);
color: var(--text-color);
z-index: 100;
padding: 20px;
box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
}
.modal h1,
.modal h2 {
margin-top: 0;
text-align: left;
color: var(--accent-color);
font-weight: normal;
font-size: 1.2em;
border-bottom: 1px solid var(--border-color);
padding-bottom: 10px;
margin-bottom: 15px;
}
.modal h2 {
font-size: 1em;
margin-bottom: 10px;
}
.modal ul {
list-style-type: none;
padding-left: 0;
}
.modal li {
margin-bottom: 8px;
font-size: 0.9em;
}
.modal li strong {
display: inline-block;
width: 130px;
color: var(--accent-color);
}
.modal-close-btn {
position: absolute;
top: 15px;
right: 20px;
font-size: 24px;
color: var(--border-color);
cursor: pointer;
background: none;
border: none;
transition: color 0.2s;
}
.modal-close-btn:hover {
color: var(--text-color);
}
#search-modal .input-group {
margin-bottom: 15px;
}
#search-modal label {
display: block;
margin-bottom: 5px;
font-size: 0.9em;
}
#search-modal #match-count {
float: right;
font-size: 0.9em;
color: #888;
}
#search-modal input {
width: 100%;
background-color: #161b22;
border: 1px solid var(--border-color);
color: var(--text-color);
padding: 8px;
box-sizing: border-box;
font-family: inherit;
font-size: 0.9em;
}
#search-modal .button-group {
display: flex;
justify-content: space-between;
gap: 10px;
}
#search-modal button {
flex-grow: 1;
background-color: #21262d;
border: 1px solid var(--border-color);
color: var(--text-color);
padding: 8px 12px;
cursor: pointer;
transition: background-color 0.2s, border-color 0.2s;
}
#search-modal button:hover {
background-color: #30363d;
border-color: var(--accent-color);
}
</style>
</head>
<body>
<div class="editor-container">
<div id="line-numbers">1</div>
<textarea id="editor" spellcheck="false" autofocus=""></textarea>
</div>
<div id="help-modal" class="modal">
<button id="help-modal-close-btn" class="modal-close-btn" aria-label="Lukk">×</button>
<h1 id="help-main-title"></h1>
<h2 id="help-title"></h2>
<ul id="help-list"></ul>
</div>
<div id="search-modal" class="modal">
<button id="search-modal-close-btn" class="modal-close-btn" aria-label="Lukk">×</button>
<h1><span id="search-main-title"></span></h1>
<h2><span id="search-title"></span></h2>
<div class="input-group">
<label for="find-input">
<span id="find-label-text"></span>
<span id="match-count"></span>
</label>
<input type="text" id="find-input">
</div>
<div class="input-group">
<label for="replace-input" id="replace-label"></label>
<input type="text" id="replace-input">
</div>
<div class="button-group">
<button id="find-next-btn"></button>
<button id="replace-btn"></button>
<button id="replace-all-btn"></button>
</div>
</div>
<script>
const lang = {
title: "Koderen",
untitled: "Uten tittel",
mainTitle: "Koderedigering for HTML CSS JS",
helpTitle: "Snarveier",
helpOpenFile: "Åpne fil",
helpSaveFile: "Lagre fil",
helpNewFile: "Ny fil",
helpSearchReplace: "Søk & erstatt",
helpToggleHelp: "Vis/skjul hjelp",
helpIndent: "Innrykk (legg til mellomrom)",
helpOutdent: "Fjern innrykk",
helpCleanup: "Total opprydding",
helpNewTab: "Åpne i ny fane",
helpPreview: "Forhåndsvis HTML",
searchTitle: "Søk & erstatt",
findLabel: "Søk:",
replaceLabel: "Erstatt med:",
findNext: "Finn neste",
replace: "Erstatt",
replaceAll: "Erstatt alle",
matches: "treff",
of: "av",
unsavedChanges: "Du har ulagrede endringer. Er du sikker?",
unsavedChangesLost: "Du har ulagrede endringer som vil gå tapt. Er du sikker?",
unsupportedApi: "Nettleseren din støtter ikke moderne File System API.",
userAbortedOpen: "Bruker avbrøt filåpning.",
userAbortedSave: "Bruker avbrøt lagringsdialogen.",
saveError: "Feil: Kunne ikke lagre filen."
};
const editor = document.getElementById('editor');
const lineNumbers = document.getElementById('line-numbers');
const helpModal = document.getElementById('help-modal');
const helpModalCloseBtn = document.getElementById('help-modal-close-btn');
const searchModal = document.getElementById('search-modal');
const searchModalCloseBtn = document.getElementById('search-modal-close-btn');
const findInput = document.getElementById('find-input');
const replaceInput = document.getElementById('replace-input');
const findNextBtn = document.getElementById('find-next-btn');
const replaceBtn = document.getElementById('replace-btn');
const replaceAllBtn = document.getElementById('replace-all-btn');
const matchCountSpan = document.getElementById('match-count');
let currentFileHandle = null;
let currentFileName = lang.untitled;
let hasUnsavedChanges = false;
let searchResults = { term: '', indices: [], currentIndex: -1 };
let lineNumberUpdateTimer = null;
const mirrorDiv = document.createElement('div');
document.body.appendChild(mirrorDiv);
function syncMirrorStyles() {
const editorStyle = window.getComputedStyle(editor);
const propertiesToCopy = [
'fontFamily', 'fontSize', 'fontWeight', 'fontStyle', 'letterSpacing',
'lineHeight', 'textTransform', 'wordSpacing', 'paddingTop', 'paddingRight',
'paddingBottom', 'paddingLeft', 'borderTopWidth', 'borderRightWidth',
'borderBottomWidth', 'borderLeftWidth', 'width', 'boxSizing',
'whiteSpace', 'overflowWrap'
];
propertiesToCopy.forEach(prop => {
mirrorDiv.style[prop] = editorStyle[prop];
});
mirrorDiv.style.position = 'absolute';
mirrorDiv.style.left = '-9999px';
mirrorDiv.style.top = '0';
mirrorDiv.style.height = 'auto';
mirrorDiv.style.visibility = 'hidden';
}
async function openFile() {
if (hasUnsavedChanges && !confirm(lang.unsavedChangesLost)) return;
if (!('showOpenFilePicker' in window)) return alert(lang.unsupportedApi);
try {
const [fileHandle] = await window.showOpenFilePicker();
currentFileHandle = fileHandle;
const file = await fileHandle.getFile();
editor.value = await file.text();
updateLineNumbers();
editor.scrollTop = 0;
editor.setSelectionRange(0, 0);
currentFileName = file.name;
document.title = currentFileName;
hasUnsavedChanges = false;
} catch (err) { console.warn(lang.userAbortedOpen, err); }
}
function newFile() {
if (hasUnsavedChanges && !confirm(lang.unsavedChanges)) return;
editor.value = '';
currentFileHandle = null;
currentFileName = lang.untitled;
document.title = currentFileName;
hasUnsavedChanges = false;
updateLineNumbers();
editor.focus();
}
async function saveFile() {
if (!currentFileHandle) {
try {
currentFileHandle = await window.showSaveFilePicker({
suggestedName: currentFileName.endsWith('.txt') ? currentFileName.replace('.txt', '.html') : currentFileName,
types: [{
description: 'Web Files',
accept: {
'text/html': ['.html', '.htm'],
'text/css': ['.css'],
'application/javascript': ['.js'],
'text/plain': ['.txt', '.md'],
},
}],
});
currentFileName = currentFileHandle.name;
} catch (err) { console.warn(lang.userAbortedSave, err); return; }
}
try {
const writable = await currentFileHandle.createWritable();
await writable.write(editor.value);
await writable.close();
hasUnsavedChanges = false;
document.title = currentFileName;
} catch (err) { console.error('Kunne ikke lagre fil:', err); alert(lang.saveError); }
}
function previewCode() {
try {
const previewWindow = window.open('', '_blank');
previewWindow.document.open();
previewWindow.document.write(editor.value);
previewWindow.document.close();
} catch (e) {
console.error("Forhåndsvisning mislyktes, muligens på grunn av popup-blokkering.", e);
alert("Kunne ikke åpne forhåndsvisning. Sjekk om popup-blokkering er aktiv.");
}
}
function cleanupCode() {
const originalValue = editor.value;
let tempValue = originalValue;
const parser = new DOMParser();
const doc = parser.parseFromString(tempValue, 'text/html');
doc.querySelectorAll('style').forEach(style => {
style.textContent = style.textContent.replace(/\/\*[\s\S]*?\*\//g, '');
});
doc.querySelectorAll('script').forEach(script => {
const jsCode = script.textContent;
const cleanedJs = jsCode.replace(/(\/\*[\s\S]*?\*\/)|(\/\/[^\r\n]*)|("(?:\\.|[^"\\])*")|('(?:\\.|[^'\\])*')|(`(?:\\.|[^`\\])*`)|(\/(?:\\.|[^\/\\])*\/[gimy]{0,4})/g,
(match, multiLineComment, singleLineComment) => (multiLineComment || singleLineComment) ? '' : match);
script.textContent = cleanedJs;
});
const walker = doc.createTreeWalker(doc.body, NodeFilter.SHOW_COMMENT);
const commentsToRemove = [];
while (walker.nextNode()) { commentsToRemove.push(walker.currentNode); }
commentsToRemove.forEach(comment => comment.remove());
tempValue = `<!DOCTYPE html>\n<html lang="${doc.documentElement.lang || 'no'}">\n${doc.documentElement.innerHTML}\n</html>`;
const cleanedValue = tempValue.split('\n')
.map(line => line.trim())
.filter(line => line !== '')
.join('\n');
if (originalValue !== cleanedValue) {
editor.value = cleanedValue;
updateLineNumbers();
if (!hasUnsavedChanges) {
hasUnsavedChanges = true;
document.title = "* " + currentFileName;
}
}
}
function toggleHelp() {
const isVisible = helpModal.style.display === 'block';
helpModal.style.display = isVisible ? 'none' : 'block';
if (isVisible) editor.focus();
}
function toggleSearch() {
const isVisible = searchModal.style.display === 'block';
searchModal.style.display = isVisible ? 'none' : 'block';
if (!isVisible) {
findInput.focus();
findInput.select();
updateSearchResults();
} else {
editor.focus();
}
}
function updateLineNumbers() {
const lineCount = editor.value.split('\n').length;
const numbers = Array.from({ length: lineCount }, (_, i) => i + 1).join('\n');
lineNumbers.textContent = numbers;
}
function debouncedUpdateLineNumbers() {
clearTimeout(lineNumberUpdateTimer);
lineNumberUpdateTimer = setTimeout(updateLineNumbers, 100);
}
function scrollToSelection() {
const textBefore = editor.value.substring(0, editor.selectionStart);
mirrorDiv.textContent = textBefore + ' ';
const selectionYPosition = mirrorDiv.offsetHeight - (parseFloat(getComputedStyle(mirrorDiv).lineHeight) || 0);
const targetScrollTop = selectionYPosition - (editor.clientHeight / 2);
editor.scrollTop = Math.max(0, targetScrollTop);
}
function escapeRegExp(string) {
return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}
function updateSearchResults() {
const searchTerm = findInput.value;
if (searchResults.term === searchTerm && searchTerm !== '') return;
searchResults.term = searchTerm;
searchResults.indices = [];
searchResults.currentIndex = -1;
matchCountSpan.textContent = '';
if (!searchTerm) return;
const escapedTerm = escapeRegExp(searchTerm);
const regex = new RegExp(escapedTerm, 'gi');
let match;
while ((match = regex.exec(editor.value)) !== null) {
searchResults.indices.push(match.index);
}
if (searchResults.indices.length > 0) {
matchCountSpan.textContent = `${searchResults.indices.length} ${lang.matches}`;
}
}
function findNext() {
updateSearchResults();
if (searchResults.indices.length === 0) return;
searchResults.currentIndex = (searchResults.currentIndex + 1) % searchResults.indices.length;
const startIndex = searchResults.indices[searchResults.currentIndex];
editor.focus();
editor.setSelectionRange(startIndex, startIndex + searchResults.term.length);
scrollToSelection();
matchCountSpan.textContent = `${searchResults.currentIndex + 1} ${lang.of} ${searchResults.indices.length}`;
}
function replaceCurrent() {
const searchTerm = findInput.value;
const replaceTerm = replaceInput.value;
if (!searchTerm || editor.selectionStart === editor.selectionEnd) {
findNext();
return;
}
const selectedText = editor.value.substring(editor.selectionStart, editor.selectionEnd);
if (selectedText.toLowerCase() === searchTerm.toLowerCase()) {
editor.setRangeText(replaceTerm, editor.selectionStart, editor.selectionEnd, 'end');
hasUnsavedChanges = true;
updateSearchResults();
findNext();
} else {
findNext();
}
}
function replaceAll() {
const searchTerm = findInput.value;
const replaceTerm = replaceInput.value;
if (!searchTerm) return;
const escapedTerm = escapeRegExp(searchTerm);
const regex = new RegExp(escapedTerm, 'gi');
const originalValue = editor.value;
const newValue = originalValue.replace(regex, replaceTerm);
if (originalValue !== newValue) {
const originalScrollTop = editor.scrollTop;
editor.value = newValue;
editor.scrollTop = originalScrollTop;
hasUnsavedChanges = true;
updateSearchResults();
}
}
function updateStaticUIText() {
document.title = lang.title;
document.getElementById('help-main-title').textContent = lang.mainTitle;
document.getElementById('help-title').textContent = lang.helpTitle;
// Fjerner Alt+C fra hjelpeteksten
document.getElementById('help-list').innerHTML = `
<li><strong>Ctrl + O</strong> ${lang.helpOpenFile}</li>
<li><strong>Ctrl + S</strong> ${lang.helpSaveFile}</li>
<li><strong>Alt + N</strong> ${lang.helpNewFile}</li>
<li><strong>Alt + F</strong> ${lang.helpSearchReplace}</li>
<li><strong>Ctrl + H</strong> ${lang.helpToggleHelp}</li>
<li><strong>Tab</strong> ${lang.helpIndent}</li>
<li><strong>Shift + Tab</strong> ${lang.helpOutdent}</li>
<li><strong>Alt + L</strong> ${lang.helpCleanup}</li>
<li><strong>Alt + T</strong> ${lang.helpNewTab}</li>
<li><strong>Alt + P</strong> ${lang.helpPreview}</li>
`;
document.getElementById('search-main-title').textContent = lang.mainTitle;
document.getElementById('search-title').textContent = lang.searchTitle;
document.getElementById('find-label-text').textContent = lang.findLabel;
document.getElementById('replace-label').textContent = lang.replaceLabel;
document.getElementById('find-next-btn').textContent = lang.findNext;
document.getElementById('replace-btn').textContent = lang.replace;
document.getElementById('replace-all-btn').textContent = lang.replaceAll;
}
findInput.addEventListener('input', updateSearchResults);
helpModalCloseBtn.addEventListener('click', toggleHelp);
searchModalCloseBtn.addEventListener('click', toggleSearch);
findNextBtn.addEventListener('click', findNext);
replaceBtn.addEventListener('click', replaceCurrent);
replaceAllBtn.addEventListener('click', replaceAll);
editor.addEventListener('scroll', () => {
lineNumbers.scrollTop = editor.scrollTop;
});
editor.addEventListener('input', () => {
if (!hasUnsavedChanges) {
hasUnsavedChanges = true;
document.title = "* " + currentFileName;
}
searchResults.term = null;
debouncedUpdateLineNumbers();
});
editor.addEventListener('keydown', function(e) {
if (e.key === 'Tab') {
e.preventDefault();
const indent = '  ';
const start = this.selectionStart;
const end = this.selectionEnd;
const selectedText = this.value.substring(start, end);
if (selectedText.includes('\n')) {
let lineStart = this.value.lastIndexOf('\n', start - 1) + 1;
let lineEnd = end;
if (this.value[end - 1] === '\n') { lineEnd = end - 1; }
const selectedLinesText = this.value.substring(lineStart, lineEnd);
let newText = '';
if (e.shiftKey) {
newText = selectedLinesText.split('\n').map(line =>
line.startsWith(indent) ? line.substring(indent.length) : line
).join('\n');
} else {
newText = selectedLinesText.split('\n').map(line => indent + line).join('\n');
}
this.setRangeText(newText, lineStart, lineEnd, 'select');
} else {
if (!e.shiftKey) {
this.setRangeText(indent, start, end, 'end');
}
}
}
});
document.addEventListener('keydown', function(e) {
const isCtrl = e.ctrlKey || e.metaKey;
const key = e.key.toLowerCase();
if (searchModal.style.display === 'block') {
if (key === 'escape') { e.preventDefault(); toggleSearch(); }
if (key === 'enter' && !e.shiftKey) { e.preventDefault(); findNextBtn.click(); }
return;
}
if (helpModal.style.display === 'block') {
if (key === 'escape') { e.preventDefault(); toggleHelp(); }
return;
}
if (isCtrl && key === 's') { e.preventDefault(); saveFile(); }
if (isCtrl && key === 'o') { e.preventDefault(); openFile(); }
if (isCtrl && key === 'h') { e.preventDefault(); toggleHelp(); }
if (e.altKey && key === 'l') { e.preventDefault(); cleanupCode(); }
if (e.altKey && key === 't') { e.preventDefault(); window.open(window.location.href, '_blank'); }
if (e.altKey && key === 'p') { e.preventDefault(); previewCode(); }
if (e.altKey && key === 'n') { e.preventDefault(); newFile(); }
if (e.altKey && key === 'f') { e.preventDefault(); toggleSearch(); }
// Fjerner Alt+C keybinding
});
window.addEventListener('load', () => {
updateStaticUIText();
updateLineNumbers();
syncMirrorStyles();
editor.focus();
toggleHelp();
});
window.addEventListener('resize', syncMirrorStyles);
window.addEventListener('beforeunload', (e) => {
if (hasUnsavedChanges) {
e.preventDefault();
e.returnValue = '';
}
});
window.addEventListener('focus', () => {
if (helpModal.style.display !== 'block' && searchModal.style.display !== 'block') {
editor.focus();
}
});
</script>
</body>
</html>
